var STATS,init,__indexOf=[].indexOf||function(e){for(var n=0,r=this.length;r>n;n++)if(n in this&&this[n]===e)return n;return-1};STATS={days:0,markers:[],open:[]},init=function(e){var n,r,t,i,o,s,a,u,c,d,l,p;return document.body.innerHTML+=function(){var e,n,r,t;for(r=["page-token","menu-token"],t=[],e=0,n=r.length;n>e;e++)s=r[e],t.push('<input type="checkbox" id="'+s+'">');return t}().join(""),document.body.innerHTML+=function(){var e,n,r,t;for(r=["grid","controls","current","preview","menu","page"],t=[],e=0,n=r.length;n>e;e++)s=r[e],t.push('<section id="'+s+'"></section>');return t}().join(""),r=new Controls("#controls",function(e){return requestAnimFrame(function(){return o.progress(e)})}),u=new Page("#page","#page-token"),t=new Current("#current",function(e){return"fin"===e.context&&a.load(),"fin"!==e.context&&(e.ref||e.more)?u.update(e):void 0}),c=new Preview("#preview"),a=new Menu("#menu","#menu-token",e,function(e){return u.update(e)}),d=document.querySelector("#restart"),o=new Grid("#grid",e.filter(function(e){return"repere"!==e.context}),{size:100,before:4,after:8,distance:2,space:20,onChange:function(n,i,s,u,c){return requestAnimFrame(function(){var n;return r.tilt(s),u&&(document.body.className=u.context,"tutoriel"!==u.context?t.update(u):t.update(u,function(){var n,r,t,i;for(o.skip(),i=[],n=0,r=e.length;r>n;n++)u=e[n],"tutoriel"===u.context&&(t=u.id,__indexOf.call(STATS.markers,t)<0)&&(STATS.markers.push(u.id),i.push(u.unlocked=!0));return i})),a.update(u?u.id:!1),STATS.days=i.q+1,u&&(n=u.id,__indexOf.call(STATS.markers,n)<0)&&!c&&STATS.markers.push(u.id),c?d.classList.add("restart-show"):void 0})},onEnter:function(e,n,r,t){return requestAnimFrame(function(){return t?c.show(t):void 0})},onLeave:function(e,n,r,t){return requestAnimFrame(function(){return c.open()?c.hide():void 0})},onMove:function(e){return d.classList.contains("restart-show")?d.classList.remove("restart-show"):void 0},onSnap:function(e,n){return n&&!d.classList.contains("restart-show")?d.classList.add("restart-show"):void 0}}),p=document.querySelector(".grid-wrap"),i=p.clientHeight,l=function(){return p.style.webkitTransform=p.style.transform=(window.innerWidth<1280?"translateX(50px) ":"")+"scale("+Math.max(.9,3*window.innerHeight/5/i)+")"},window.addEventListener("resize",function(){return requestAnimFrame(l)}),l(),window.addEventListener("keydown",function(e){return requestAnimFrame(function(){var n,r,i;return 38===(n=e.which)||40===n?o.slide([!0,!1][[38,40].indexOf(e.which)]):37===(r=e.which)||39===r?o.progress([!0,!1][[37,39].indexOf(e.which)]):e.ctrlKey||e.altKey||e.metaKey?!0:13===e.which&&"loaded"!==document.body.id?document.body.id="loaded":32!==(i=e.which)&&77!==i&&84!==i||u.isOpen()?13===e.which&&t.isPage()&&!a.isOpen()?u.isOpen()?u.close():u.open():27===e.which&&u.isOpen()?u.close():27===e.which&&a.isOpen()?a.close():void 0:a.isOpen()?a.close():a.open()})}),window.progress(),n=document.querySelector(".preload-progress"),n.classList.add("preload-start"),n.addEventListener("click",function(){return document.body.id="loaded"})},function(){var e,n,r,t,i,o,s;return"ie"===(s=head.browser.name)||"ff"===s||"opera"===s?!1:(i={libs:["http://cdnjs.cloudflare.com/ajax/libs/mustache.js/2.1.2/mustache.min.js","http://cdnjs.cloudflare.com/ajax/libs/hammer.js/2.0.4/hammer.min.js"],scripts:["helpers","grid","views"].map(function(e){return"app/"+e+".js"}),css:["app"].map(function(e){return"public/css/"+e+".css"})},t=function(){var e;e=[];for(n in i)o=i[n],e.push(o.join(","));return e}().join(",").split(",").reverse(),window.progress=function(){var e,n,r,i,o,s,a;return s=[".preload-progress",".preload-progress-bar",".preload-progress-label"].map(function(e){return document.querySelector(e)}),o=s[0],e=s[1],r=s[2],a=[2+t.length,0],i=a[0],n=a[1],function(){return n++,o.dataset.value=n+"/"+i,e.style.width=n/i*100+"%",n===i-1?r.innerHTML="génération du terrain…":void 0}}(),r=function(e,n){return 0===e.length?n():(head.load(e.slice(-1)+"?t="+(new Date).getTime(),function(){return r(e.slice(0,-1),n)}),progress())},e=new Image,e.src="public/images/background.jpg",e.addEventListener("load",function(){return progress(),r(t,function(){return async("GET","data.json",init)})}))}();
